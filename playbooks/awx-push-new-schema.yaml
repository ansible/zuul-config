---
- hosts: static
  roles:
    - role: run_awx_tests
      command: /start_tests.sh genschema
      artifacts:
        - /awx_devel/schema.json
  tasks:
    - name: Upload new schema
      aws_s3:
        bucket: awx-public-ci-files
        object: schema.json
        src: "/awx_devel/schema.json"
        mode: put
        permission: public-read
      environment:
        AWS_ACCESS_KEY: '{{ amazon.access_key_id }}'
        AWS_SECRET_KEY: '{{ amazon.secret_access_key }}'
        AWS_REGION: 'us-east-1'
